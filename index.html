<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>2048 game</title>
    <!-- Game Design Style css -->
    <style>
        body {
            overflow: hidden;
            max-width: 100%;
            max-height: 100%;
        }

        .game {
            height: 100%;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        h2 {
            margin-bottom: 20px;
            color: #000000;
            text-shadow: 2px 2px 2px #6d6d6dc9;
        }

        #game-board {
            width: 400px;
            height: 400px;
            background-color: #bbada0;
            border-radius: 10px;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 5px;
            padding: 5px;
        }

        .tile {
            width: 95px;
            height: 95px;
            overflow: hidden;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 29px;
            font-weight: bold;
            color: #424242;
        }

        .game-score {
            margin: 10px 0;
            font-size: 18px;
            font-weight: bold;
            color: #51ff00;
        }

        #reset-btn {
            background-color: #3632ff;
            color: #ffffff;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;

        }

        #reset-btn:hover {
            background-color: #0400ff;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <!--Game section in html-->>
    <div class="game">
        <h2>2048</h2>
        <div id="game-board"></div>
        <div class="game-score">Score: <span id="score">0</span></div>
        <button id="reset-btn">Start over</button>
    </div>
    <!--Game Script-->>
    <script>
        // Define main DOM elements and game variables
        const gameBoard = document.querySelector("#game-board");
        const scoreDisplay = document.querySelector("#score");
        const resetBtn = document.querySelector("#reset-btn");

        let board = Array(4).fill().map(() => Array(4).fill(0));
        let score = 0;
        // Resets the game board and score
        function Reset() {
            board = Array(4).fill().map(() => Array(4).fill(0));
            score = 0;
            scoreDisplay.textContent = score;
            Add();
            Add();
            Board();
        }
        // Adds a new random tile (2 or 4) to the board
        function Add() {
            const emptyCells = [];
            for (let i = 0; i < 4; i++) {
                for (let j = 0; j < 4; j++) {
                    if (board[i][j] === 0) emptyCells.push([i, j]);
                }
            }
            if (emptyCells.length > 0) {
                const [i, j] = emptyCells[Math.floor(Math.random() * emptyCells.length)];
                board[i][j] = Math.random() < 0.9 ? 2 : 4;
            }
        }
        
        function Board() {
            gameBoard.innerHTML = "";
            for (let i = 0; i < 4; i++) {
                for (let j = 0; j < 4; j++) {
                    const tile = document.createElement("div");
                    tile.className = "tile";
                    tile.textContent = board[i][j] === 0 ? "" : board[i][j];
                    tile.style.backgroundColor = Color(board[i][j]);
                    gameBoard.appendChild(tile);
                }
            }
        }
        // Returns the background color for each tile value
        function Color(value) {
            const colors = {
                0: "#cdc1b4" ,
                2: "#eee4da",
                4: "#ede0c8",
                8: "#f2b179",
                16: "#f59563",
                32: "#f67c5f",
                64: "#f65e3b",
                128: "#edcf72",
                256: "#edcc61",
                512: "#edc850",
                1024: "#edc53f",
                2048: "#edc22e",
            };
            return colors[value] || "#3c3a32";
        }
        // Motion logic
        function Move(direction) {
            let moved = false;
            let newBoard = JSON.parse(JSON.stringify(board));
            if (direction === "left") {
                for (let i = 0; i < 4; i++) {
                    let row = newBoard[i].filter((val) => val !== 0);
                    for (let j = 0; j < row.length - 1; j++) {
                        if (row[j] === row[j + 1]) {
                            row[j] *= 2;
                            score += row[j];
                            row[j + 1] = 0;
                            moved = true;
                        }
                    }
                    row = row.filter((val) => val !== 0);
                    while (row.length < 4) row.push(0);
                    newBoard[i] = row;
                }
            } else if (direction === "right") {
                for (let i = 0; i < 4; i++) {
                    let row = newBoard[i].filter((val) => val !== 0);
                    for (let j = row.length - 1; j > 0; j--) {
                        if (row[j] === row[j - 1]) {
                            row[j] *= 2;
                            score += row[j];
                            row[j - 1] = 0;
                            moved = true;
                        }
                    }
                    row = row.filter((val) => val !== 0);
                    while (row.length < 4) row.unshift(0);
                    newBoard[i] = row;
                }
            } else if (direction === "up") {
                for (let j = 0; j < 4; j++) {
                    let col = [newBoard[0][j], newBoard[1][j], newBoard[2][j], newBoard[3][j]].filter((val) => val !== 0);
                    for (let i = 0; i < col.length - 1; i++) {
                        if (col[i] === col[i + 1]) {
                            col[i] *= 2;
                            score += col[i];
                            col[i + 1] = 0;
                            moved = true;
                        }
                    }
                    col = col.filter((val) => val !== 0);
                    while (col.length < 4) col.push(0);
                    for (let i = 0; i < 4; i++) newBoard[i][j] = col[i];
                }
            } else if (direction === "down") {
                for (let j = 0; j < 4; j++) {
                    let col = [newBoard[0][j], newBoard[1][j], newBoard[2][j], newBoard[3][j]].filter((val) => val !== 0);
                    for (let i = col.length - 1; i > 0; i--) {
                        if (col[i] === col[i - 1]) {
                            col[i] *= 2;
                            score += col[i];
                            col[i - 1] = 0;
                            moved = true;
                        }
                    }
                    col = col.filter((val) => val !== 0);
                    while (col.length < 4) col.unshift(0);
                    for (let i = 0; i < 4; i++) newBoard[i][j] = col[i];
                }
            }
            if (JSON.stringify(newBoard) !== JSON.stringify(board)) {
                board = newBoard;
                moved = true;
            }
            return moved;
        }
        // Checks if the game is won, lost, or still ongoing
        function checkOver() {
            for (let i = 0; i < 4; i++) {
                for (let j = 0; j < 4; j++) {
                    if (board[i][j] === 2048) return "win";
                    if (board[i][j] === 0) return false;
                    if (i < 3 && board[i][j] === board[i + 1][j]) return false;
                    if (j < 3 && board[i][j] === board[i][j + 1]) return false;
                }
            }
            return "lose";
        }

        document.addEventListener("keydown", (e) => {
            let moved = false;
            switch (e.key) {
                case "ArrowUp":
                    moved = Move("up");
                    break;
                case "ArrowDown":
                    moved = Move("down");
                    break;
                case "ArrowLeft":
                    moved = Move("left");
                    break;
                case "ArrowRight":
                    moved = Move("right");
                    break;
            }
            if (moved) {
                Add();
                Board();
                scoreDisplay.textContent = score;
                const gameState = checkOver();
                if (gameState === "win") {
                    alert("Congratulations! You've reached 2048!");
                } else if (gameState === "lose") {
                    alert("You lost! There is no more movement.");
                }
            }
        });
        //Restart Game Logic
        resetBtn.addEventListener("click", () => {
            Reset();
        });

        Reset();
    </script>
</body>

</html>